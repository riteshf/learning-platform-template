# AI Agent Coding Instructions

## Project Overview

This is a **multi-language course content management template** that manages structured educational content (courses, lessons, slides, questions) with i18n support. The project emphasizes strict schema validation and referential integrity across language variants.

### Core Architecture

```
courses/
├── {course-slug}/
│   ├── en/
│   │   ├── courses.json      # Single course metadata
│   │   ├── lessons.json      # Array of lesson objects
│   │   ├── slides.json       # Array of slide objects
│   │   └── questions.json    # Array of question objects
│   ├── mr/                   # Each language is separate folder
│   └── {other-languages}/
```

**Critical Design Decision**: Each JSON file is an **array at the root level**, not a single object. The backend automatically generates unique IDs and establishes relationships (courseSlug, lessonId, slideId) during import, enabling per-language independence.

## Key Data Models

### Course Structure
- **Required**: `title`
- **Optional**: `slug` (backend generates from title if not provided), `description`, `instructorEmail` (backend uses auth context if not provided), `isPublished`
- Only ONE course per `courses.json` (array with 1 item)

### Lessons
- **Required**: `title`, `order` (non-negative integer)
- **Optional**: `id` (backend generates unique ID), `courseSlug` (backend associates with course), `description`, `duration` (minutes, must be non-negative)
- **Pattern**: Backend establishes relationships after import

### Slides
- **Required**: `title`, `type`, `order`, `content` (object)
- **Optional**: `id` (backend generates unique ID), `lessonId` (backend associates with lesson)
- **Types**: `"intro" | "content" | "interactive" | "closing"`
- **Critical**: `content` must be valid serializable JSON object (no circular refs)

### Questions
- **Required**: `type`, `question`
- **Optional**: `id` (backend generates unique ID), `lessonId` (backend associates with lesson), `mandatory`, `slideId` (for slide-level questions)
- **Types**: `"POLL" | "QUIZ" | "SELECT" | "MULTI_SELECT" | "CHECKLIST" | "TEXT"`
- **Pattern**: QUIZ/SELECT/MULTI_SELECT use `correctAnswer`/`correctAnswers` (indices); TEXT uses `correctTextAnswer`

## Developer Workflows

### Validation (Critical Workflow)
```bash
yarn validate              # Validates all courses (all languages)
yarn validate:course       # Single course file
yarn validate:lessons      # Lesson schemas & referential integrity
yarn validate:slides       # Slide schemas & content structure
yarn validate:questions    # Question schemas & answer validation
```

**Validation runs against `courses/` directory** - validates all subdirectories recursively. Files must be in language folders (`en/`, `mr/`, etc.) to be discovered.

### Adding New Content

1. **Create course directory**: `courses/{slug}/`
2. **For each language**: Create `{language}/` subfolder
3. **Add four JSON files** in language folder (all required):
   - `courses.json` - array with 1 course object
   - `lessons.json` - array of lesson objects with unique `id`
   - `slides.json` - array of slide objects
   - `questions.json` - array of question objects
4. **Run validation** to catch schema/referential errors before push

### Language Addition
When adding a new language to existing course:
- Maintain identical `order` values across language folders for consistent content sequence
- Example: `courses/ai-ml-101/en/` and `courses/ai-ml-101/mr/` have same lesson order with different `title`/`description`
- IDs are optional and will be generated by backend during import

## Validation & Error Handling Patterns

### Referential Integrity Checks
The validator ensures:
- Content structure is valid (titles, types, order fields present)
- `order` fields are sequential starting from 1 (or 0, but consistent)
- All required fields present and typed correctly
- **Note**: Backend handles ID generation and relationship mapping during import

### Validation Error Format
```typescript
{
  field: string;           // "title", "type", "order", etc.
  message: string;         // Human readable error
  path?: string;          // File path if file-level error
}
```

### Common Validation Failures
- **JSON Parse Errors**: Malformed JSON → caught immediately
- **Missing Required Fields**: Will fail with field name (e.g., missing `title`, `type`, `question`)
- **Type Mismatches**: `order` as string instead of number → rejected
- **Enum Violations**: Slide type not in `["intro", "content", "interactive", "closing"]`
- **Email Format**: Must match basic email regex pattern (if provided)

## File Organization Conventions

- **No nested course directories**: `courses/course-a/course-b/` structure is NOT supported
- **Language codes**: ISO 639-1 (2-letter): `en`, `es`, `fr`, `de`, `zh`, `ja`, `pt`, `ru`, `ar`, `hi`, `ko`, `mr`
- **Slug format**: Lowercase only, no spaces, underscores/hyphens allowed: `my-course_123` ✓, `MyCourse` ✗
- **Field naming**: camelCase in JSON (e.g., `instructorEmail`, `isPublished`)

## TypeScript Types Location

Reference types in `validation/types.ts`:
- `CourseContent`, `LessonContent`, `SlideContent`, `QuestionContent`
- `CourseStructure` - represents full course data
- `LanguageContent` - single language variant
- `ValidationError`, `ValidationResult`

When adding validation or schema changes, update both `types.ts` AND relevant `validate-*.ts` file.

## Common Patterns

### Adding a Question Type
1. Update `QuestionContent` type in `validation/types.ts`
2. Add handling in `validate-question.ts` (required fields for new type)
3. Add type literal to question validation enum
4. Test: `yarn validate:questions`

### Refactoring Validation
- Split logic by concern: separate validator per file type
- Keep validators pure functions (take data, return `ValidationResult`)
- Always return errors array, even if empty (`valid: true, errors: []`)

## Development Notes

- **No build step**: TypeScript runs via `ts-node` for validation scripts
- **No database**: All content is JSON file-based (single source of truth)
- **Multi-language by design**: Never assume one language is "primary"
- **Extensibility**: Add slide types, question types, or fields by updating types first, then validators
